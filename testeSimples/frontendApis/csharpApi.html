<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{margin: 0;padding: 0;box-sizing: border-box;}
        body{background-color: black;color: white;}

        #root {
            width: 850px;
            height: auto;
            margin: 0 auto;
        }

        .inputs {
            background-color: white;
            color: tomato;
            padding: 10px;
            border-radius: 10px;
            margin-top: 10px;
        }
        .inputs input {
            width: 40%;
            padding: 10px;
            color: tomato;
            border: 1px solid tomato;
        }

        .cards {
            background-color: white;
            color: tomato;
            border-radius: 10px;
            margin: 10px 0px 10px 0px;
            padding: 10px;
        }
        .cards h1 {
            margin-bottom: 6px;
        }
    </style>
</head>
<body>
    
    <div id="root"></div>

    <script>
        class Inputs {
            static input() {
                const div = document.createElement('div')
                div.classList.add('inputs')
                div.innerHTML = `
                    <input type='text' id="name" name="name" placeholder="Nome" />
                    <input type='text' id="tipo" name="tipo" placeholder="Tipo" />
                    <button id="enviar">enviar</button>
                `

                document.getElementById('root').appendChild(div)
            }
        }
        class ApiCsharp {
            build() {
                Inputs.input()

                document.getElementById('enviar').addEventListener('click', () => {
                    this.metodoPost()
                })

                document.querySelector('#root').addEventListener('click', (e) => {
                    console.log(e.target.dataset.id);
                    const remover = e.target.dataset.id

                    if (remover) {
                        this.metodoDelete(remover)
                    }

                    const editar = e.target.dataset.editar 
                    if (editar) {
                        const nome = document.getElementById('name')
                        const tipo = document.getElementById('tipo')

                        if (!nome || !tipo) {
                            console.error("Inputs nome e tipo não encontrado");
                            return
                        }
                        
                        const idNome = nome.value.trim()
                        const idTipo = tipo.value.trim()

                        if (!idNome || ! idTipo) {
                            console.warn("idNome e idTipo nao pode estar vazios");
                            return
                        }

                        const enviar = {
                            nome: idNome,
                            tipo: idTipo
                        }

                        this.metodoPut(editar, enviar)
                    }    
                })

                this.metodoFetch()
                this.metodoGetID(1)
            }
            async metodoFetch() {
                const req = await fetch(`http://localhost:5139/api/Persons`)
                const res = await req.json()
                
                res.map((itens) => {
                    console.log(itens.length);
                    
                    const section = document.createElement('section')
                    section.classList.add('cards');
                    // section.setAttribute('data-id', `${itens.id}`)
                    section.innerHTML = `
                        <h1>Nome: ${itens.nome}</h1>
                        <b>Tipo: ${itens.tipo}</b>
                        <button data-editar="${itens.id}">editar</button>
                        <button data-id="${itens.id}">X</button>
                    `
                    document.getElementById('root').appendChild(section)
                })

                
            }

            async metodoPost() {
                const nome = document.getElementById('name')
                const tipo = document.getElementById('tipo')

                if (!nome || !tipo) {
                    console.error("Inputs nome e tipo não encontrado");
                    return
                }
                
                const idNome = nome.value.trim()
                const idTipo = tipo.value.trim()

                if (!idNome || ! idTipo) {
                    console.warn("idNome e idTipo nao pode estar vazios");
                    return
                }

                const enviar = {
                    nome: idNome,
                    tipo: idTipo
                }
                console.log(enviar);
                
                try {
                    const req = await fetch(`http://localhost:5139/api/Persons`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(enviar)
                    })
                    const res = await req.json()
                    console.log('sucesso: ', res);

                    nome.value = ''
                    tipo.value = ''
                    
                } catch (error) {
                    console.error("Erro no POST");
                }

            }

            async metodoDelete(id) {
                try {
                    const req = await fetch(`http://localhost:5139/api/Persons/${id}`, {
                        method: 'DELETE',
                    })
                    
                } catch (error) {
                    console.error("Erro no Delete");
                }
            }

            async metodoPut(id, dados) {
                try {
                    const req = await fetch(`http://localhost:5139/api/Persons/${id}`, { 
                        method: 'PUT', 
                        headers: {
                            'Content-Type': 'application/json' 
                        
                        },
                        body: JSON.stringify(dados) 
                    });


                    const res = await req.json()
                    console.log(`PUT Sucesso para ID ${id}:`, res)

                    // await this.metodoFetch(); 

                    return res; 

                } catch (error) {
                    console.error(`Erro inesperado no PUT para ID ${id}:`, error.message || error)
                
                    throw error; 
                }
            }

            async metodoGetID(id) {
                const req = await fetch(`http://localhost:5139/api/Persons/${id}`, {
                    method: 'GET'
                })
                const res = await req.json()
                console.log(res);
                
            }
        }

        const apiCsharp = new ApiCsharp()
        // apiCsharp.metodoFetch()
        apiCsharp.build()
    </script>
</body>
</html>